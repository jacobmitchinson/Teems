var expect = require('chai').expect; 
var nock = require('nock');
var Teams = require('../app/lib/teams.js');

describe('Teams', function() { 
  
  var url = 'http://api.football-data.org';
  var premierLeagueJSON = { _links:
                           {self: { href: 'http://api.football-data.org/alpha/soccerseasons/354' },
                            teams: { href: 'http://api.football-data.org/alpha/soccerseasons/354/teams' },
                            fixtures: { href: 'http://api.football-data.org/alpha/soccerseasons/354/fixtures' },
                            leagueTable: { href: 'http://api.football-data.org/alpha/soccerseasons/354/leagueTable' } },
                            caption: 'Premier League 2014/15',
                            league: 'PL',
                            year: '2014',
                            numberOfTeams: 20,
                            numberOfGames: 380,
                            lastUpdated: '2015-04-19T18:15:55Z' }
  var teamsJSON = '{"_links":[{"self":"http://api.football-data.org/alpha/soccerseasons/354/teams"},{"soccerseason":"http://api.football-data.org/alpha/soccerseasons/354"}],"count":20,"teams":[{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/66"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/66/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/66/players"}},"name":"Manchester United FC","code":"MUFC","shortName":"ManU","squadMarketValue":"425,000,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/d/da/Manchester_United_FC.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/72"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/72/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/72/players"}},"name":"Swansea City","code":"SWA","shortName":"Swans","squadMarketValue":"104,000,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/a/ab/Swansea_City_Logo.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/338"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/338/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/338/players"}},"name":"Leicester City","code":"LCFC","shortName":"Foxes","squadMarketValue":"63,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/en/6/63/Leicester02.png"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/62"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/62/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/62/players"}},"name":"Everton FC","code":"EFC","shortName":"Everton","squadMarketValue":"179,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/f/f9/Everton_FC.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/563"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/563/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/563/players"}},"name":"West Ham United FC","code":"WHU","shortName":"West Ham","squadMarketValue":"119,750,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/e/e0/West_Ham_United_FC.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/73"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/73/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/73/players"}},"name":"Tottenham Hotspur FC","code":"THFC","shortName":"Spurs","squadMarketValue":"262,750,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/b/b4/Tottenham_Hotspur.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/74"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/74/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/74/players"}},"name":"West Bromwich Albion","code":"WBA","shortName":"West Bromwich","squadMarketValue":"80,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/8/8b/West_Bromwich_Albion.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/71"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/71/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/71/players"}},"name":"Sunderland AFC","code":"SUN","shortName":"Sunderland","squadMarketValue":"84,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/6/60/AFC_Sunderland.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/70"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/70/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/70/players"}},"name":"Stoke City FC","code":"SCFC","shortName":"Stoke","squadMarketValue":"101,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/a/a3/Stoke_City.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/58"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/58/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/58/players"}},"name":"Aston Villa FC","code":"AVFC","shortName":"Aston Villa","squadMarketValue":"105,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/9/9f/Aston_Villa_logo.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/69"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/69/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/69/players"}},"name":"Queens Park Rangers","code":"QPR","shortName":"QPR","squadMarketValue":"91,000,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/d/d4/Queens_Park_Rangers.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/322"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/322/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/322/players"}},"name":"Hull City FC","code":"HUL","shortName":"Hull","squadMarketValue":"89,750,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/a/a9/Hull_City_AFC.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/57"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/57/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/57/players"}},"name":"FC Arsenal London","code":"AFC","shortName":"Arsenal","squadMarketValue":"390,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/en/5/53/Arsenal_FC.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/354"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/354/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/354/players"}},"name":"Crystal Palace","code":"CRY","shortName":"Crystal","squadMarketValue":"86,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/b/bf/Crystal_Palace_F.C._logo_(2013).png"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/64"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/64/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/64/players"}},"name":"Liverpool FC","code":"LFC","shortName":"Liverpool","squadMarketValue":"310,750,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/0/0a/FC_Liverpool.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/340"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/340/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/340/players"}},"name":"FC Southampton","code":"SFC","shortName":"Southampton","squadMarketValue":"189,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/c/c9/FC_Southampton.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/67"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/67/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/67/players"}},"name":"Newcastle United","code":"NUFC","shortName":"Newcastle","squadMarketValue":"122,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/5/56/Newcastle_United_Logo.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/65"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/65/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/65/players"}},"name":"Manchester City FC","code":"MCFC","shortName":"ManCity","squadMarketValue":"418,250,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/f/fd/ManCity.svg"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/328"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/328/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/328/players"}},"name":"FC Burnley","code":"BFC","shortName":"Burnley","squadMarketValue":"46,750,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/thumb/4/49/FC_Burnley.svg/376px-FC_Burnley.svg.png"},{"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/61"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/61/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/61/players"}},"name":"Chelsea FC","code":"CFC","shortName":"Chelsea","squadMarketValue":"484,000,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/5/5c/Chelsea_crest.svg"}]}';
  var westBrom = {"_links":{"self":{"href":"http://api.football-data.org/alpha/teams/74"},"fixtures":{"href":"http://api.football-data.org/alpha/teams/74/fixtures"},"players":{"href":"http://api.football-data.org/alpha/teams/74/players"}},"name":"West Bromwich Albion","code":"WBA","shortName":"West Bromwich","squadMarketValue":"80,500,000 €","crestUrl":"http://upload.wikimedia.org/wikipedia/de/8/8b/West_Bromwich_Albion.svg"}
  var teams;

  function mockEndPoint(queryString, data) {  
    nock(url)
      .get('/' + queryString)
      .reply(200, data)
  };

  beforeEach(function() {
    mockEndPoint('alpha/soccerseasons/354', premierLeagueJSON);
    mockEndPoint('alpha/soccerseasons/354/teams', teamsJSON);
    teams = new Teams();
  });

  it('should get all teams', function(done) { 
    teams.all(premierLeagueJSON, function(err, body) { 
      expect(body).to.eql(teamsJSON);
      done();
    });
  });

  it('should get a specific team', function(done) { 
    teams.find(premierLeagueJSON, 'WBA', function(err, team) { 
      expect(team).to.eql(westBrom);
      done();
    });
  });

});